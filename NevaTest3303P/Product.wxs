<?xml version="1.0" encoding="UTF-8"?>
<Wix
	xmlns="http://wixtoolset.org/schemas/v4/wxs"
>

	<?include NevaTest3303P.wxi?>

	<Product
		Id="$(var.ProductCode)"
		Name="$(var.Manufacturer) $(var.ProductName)"
		Version="$(var.ProductVersion)"
		Language="1049"
		Codepage="1251"
		Manufacturer="$(var.Manufacturer)"
		UpgradeCode="$(var.UpgradeCode)"
	>
		
		<Package
			InstallerVersion="500"
			InstallScope="perMachine"
			InstallPrivileges="elevated"
			AdminImage="$(var.IsAdminImage)"
			Compressed="$(var.Compressed)"
			Manufacturer="IT-Service"
			SummaryCodepage="!(loc.CodePage)"
			ShortNames="no"
			Description="!(loc.PackageDescription) $(var.ProductName)."
			Languages="!(loc.LCID)"
			Comments="!(loc.PackageDescription) $(var.ProductName)."
			Keywords="Installer, $(var.ProductShortName)"
		/>

		<WixVariable Id="ManufacturerId"			Value="$(var.ManufacturerId)"/>
		<WixVariable Id="ProductInternalName" Value="$(var.ProductInternalName)"/>
		<WixVariable Id="ProductShortName"		Value="$(var.ProductShortName)"/>
		<WixVariable Id="ProductMajorVersion" Value="$(var.ProductMajorVersion)"/>
		<WixVariable Id="ProductMinorVersion" Value="$(var.ProductMinorVersion)"/>

		<FeatureRef Id="$(var.ProductInternalName)"/>

		<Upgrade Id="$(var.UpgradeCode)">
			<UpgradeVersion
				Minimum="$(var.ProductVersion)"
				IncludeMinimum="no"
				Property="WIX_DOWNGRADE_DETECTED"
			/>
			<UpgradeVersion
				Minimum="1.0.0"
				IncludeMinimum="yes"
				Maximum="$(var.ProductVersion)"
				IncludeMaximum="no"
				RemoveFeatures=" "
				Property="WIX_MINOR_UPGRADE_DETECTED"
				MigrateFeatures="yes"
				IgnoreRemoveFailure="no"
			/>
		</Upgrade>
		<Condition Message="!(loc.NewProductVersionExists)">
			<![CDATA[NOT WIX_DOWNGRADE_DETECTED]]>
		</Condition>
		<InstallExecuteSequence>
			<RemoveExistingProducts After="InstallExecute">
			</RemoveExistingProducts>
		</InstallExecuteSequence>

		<CustomActionRef Id="UninstallOriginalOLDPackage"/>

		<Property Id="ARPREADME" Value="$(var.ProductRepositoryURL)/blob/master/readme.md"/>
		<Property Id="ARPCOMMENTS" Value="$(var.ProductDescription)"/>
		<Property Id="ARPURLINFOABOUT" Value="$(var.ProductRepositoryURL)/blob/master/readme.md"/>
		<Property Id="ARPURLUPDATEINFO" Value="$(var.ProductRepositoryURL)/releases"/>
		<Property Id="ARPHELPLINK" Value="$(var.ProductRepositoryURL)/wiki"/>
		<Property Id="ARPCONTACT" Value="ИТ-Сервис"/>

		<?ifdef AdminImage ?>
		<Property Id="ARPNOMODIFY" Value="1"/>
		<?endif?>
		<!--<Property Id="ARPNOREMOVE" Value=""/>-->
		<!--<Property Id="ARPNOREPAIR" Value=""/>-->
		<!--<Property Id="ARPSYSTEMCOMPONENT" Value=""/>-->

		<Property Id="MSIARPSETTINGSIDENTIFIER" Value="$(var.ProductSettingsKey)"/>

		<Icon Id="Product.ico" SourceFile=".\Icons\Product.ico"/>
		<Property Id="ARPPRODUCTICON" Value="Product.ico"/>
		
		<!--<Icon Id="Help.ico" SourceFile=".\Icons\Help.ico"/>-->

		<Property Id="PRIMARYFOLDER" Value="APPLICATIONFOLDER" />
		<SetProperty Id="ARPINSTALLLOCATION" Value="[APPLICATIONFOLDER]" Sequence="execute" Before="InstallInitialize">
			<![CDATA[NOT Installed]]>
		</SetProperty>
		<Property Id="APPLICATIONFOLDER" Admin="yes" />

		<!--<Property Id="ARPSIZE" Value=""/>-->

		<?ifdef AdminImage ?>
		<Property Id="MSIFASTINSTALL" Value="3"/>
		<?endif?>

		<Property Id="MSIRESTARTMANAGERCONTROL" Value="Disable"/>
		
		<Property Id="INSTALLLEVEL" Value="3"/>

		<MediaTemplate EmbedCab="$(var.Compressed)"/>

		<!-- возможность отключения создания ярлыков -->
		<InstallExecuteSequence>
			<CreateShortcuts Sequence="4500">
				<![CDATA[NOT DISABLESHORTCUTS]]>
			</CreateShortcuts>
		</InstallExecuteSequence>

		<Property Id="DISABLESHORTCUTS" Admin="yes"/>
		<!-- возможность отключения создания ярлыков - конец -->

		<!-- возможность отключения создания ярлыков по одному -->
		<?foreach ShFolder in $(var.ShFolders)?>
		
		<SetDirectory Id="$(var.ShFolder)" Value="[TempFolder]">
			<![CDATA[DISABLE$(var.ShFolder)SHORTCUTS]]>
		</SetDirectory>

		<Property Id="DISABLE$(var.ShFolder)SHORTCUTS" Admin="yes"/>
		
		<?endforeach?>
		<!-- возможность отключения создания ярлыков по одному - конец -->

		<?ifndef AdminImage ?>

		<UI>
			<!--<UIRef Id="WixUI_Mondo"/>-->
			<UIRef Id="WixUI_MondoWithoutLicenseDlg"/>
			<!--<UIRef Id="WixUI_ErrorProgressText" />-->
		</UI>
		<Property Id="WixAppFolder" Value="WixPerMachineFolder" />
		<WixVariable Id="WixUISupportPerUser" Value="0" />
		<!--<WixVariable Id="WixUILicenseRtf" Value="eula.rtf" />-->

		<?endif?>

	</Product>

</Wix>